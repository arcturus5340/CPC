{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../static/@chrisoakman/chessboardjs/dist/chessboard-1.0.0.css"/>
</head>
<body>

    <a href="/add_board/">Новая доска</a>

    <script src="{% static "jquery/dist/jquery.js" %}"></script>
    <script src="{% static "chess.js/chess.js" %}"></script>
    <script src="{% static "@chrisoakman/chessboardjs/dist/chessboard-1.0.0.js" %}"></script>
    {% for chess_board in ChessBoards %}
        <div id="board-{{ chess_board.0 }}" style="width: 400px"></div>
    {% endfor %}
    <script>
        var boards = [];

        config = {
            position: 'start',
        };

        {% for chess_board in ChessBoards %}
            boards.push({'id': {{ chess_board.0 }}, 'board': Chessboard('board-{{ chess_board.0 }}', config)});
        {% endfor %}

        function makeRandomMove(value){
            $.ajax({
                url: '/make_random_move/',
                type: 'post',
                data: {
                    id: value['id'],
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                },
                success: function(response){
                    value['board'].position(response['FEN']);
                    window.setTimeout(makeRandomMove, 500, value);
                },
                error: function(){
                    // TODO: handle the error of sending the ajax-request
                },
            });
        }

        for (var board_index in boards) {
            window.setTimeout(makeRandomMove, 500, boards[board_index]);
        }
    </script>
</body>
</html>